Rakennekuvaus

Huom! Tallennustiedoston suhteellisen osoitteen luonnissa oli hieman ongelmia, minkä vuoksi jar-tiedosto ei välttämättä toimi. Ongelma korjaantuu, jos laivanupotus-kansiossa olevan savefile.txt-tiedoston kopioi dist-hakemistoon.

Pelin logiikan keskeisin kokonaisuus on Peli-luokka. Peli luo konstruktorissaan Pelaajan ja Tietokonevastustajan, ja peli on koko ajan vastuussa pelin etenemisestä ja tietoinen pelin vaiheesta. Pelaajan ampuminen käyttöliittymässä kutsuu Pelin pelaaKierros-metodia, joka hallinnoi pelin kierroksen pelaamisen. Peli myös tietää, kun toinen pelaajista voittaa, ja suorittaa tällöin tarvittavat ilmoitukset.

Pelaaja ja Tietokonevastustaja ovat rakenteeltaan varsin samankaltaiset, ja varmasti hyvä ratkaisu olisikin ollut toteuttaa näille yhteinen aliluokka, koska iso osa metodeista on samoja. Pelaaja ja Vastus luovat itselleen pelilaudat, ja hallinnoivat laivojen asetusta laudalle. Luokat myös palauttavat tiedon lautaansa kohdistuvan ammunnan tuloksesta. Tietokonevastustajan tekoäly sijaitsee myös täällä.

Pelilauta on kuva kummankin pelaajan omasta pelilaudasta. Pelilaudalla on metodeja, jotka hallinnoivat laivojen asetusta lautaan, ja esim. tarkistavat asetuksen oikeellisuuden. Pelilauta tuntee kaikki sata ruutuansa. Ruutu on pelilaudan osa, joka tuntee sijaintinsa pelilaudalle, omat naapuriruutunsa, tietää onko siinä laivaa, ja jos on, tietää myös kyseisen laivan.

Pelaaja ja Tietokonevastustaja tuntevat molemmat omat laivansa. Laiva tietää kokonsa, sijaintinsa, onko se uponnut ja moneenko ruutuun siinä on osuttu. Laivasta voi upottaa uuden pisteen kutsumalla sen osuma-metodia.

Käyttöliittymän keskeisin luokka on Laivanupotus. Laivanupotus on JFramen aliluokka, joka luo kaikki käyttöliittymään tarvittavat napit ja tekstikentät. Käyttöliittymän nappulat ovat Jbuttoneita, ja sen aliluokkana toteutettuja Nappeja, jotka eroavat sillä että e tuntevat sijaintinsa pelilaudalla. Nappeihin on liitetty ActionListener-rajapinnan toteuttavat Kuuntelijat, jotka kutsuvat nappulaan sopivaa metodia (pelaajan omalla laudalla olevat nappulat kutsuvat aseta-metodia, vastustajan laudan nappulat ammu-metodia). Käyttöliittymässä on lisäksi ilmoitusPop-luokka, joka nimensä mukaan on ilmoituksen tekevä pop up -ikkuna. IlmoitusPop ilmestyy pelin lopussa, jolloin se ilmoittaa peliin liittyviä tilastoja ja tarjoaa napit uuden pelin aloittamiseen ja pelaamisen lopettamiseen. IlmoitusPop voi ilmestyä myös, kun kesken pelin painetaan lopeta- tai resetointipainiketta, jolloin se varoittaa lopettamisesta kesken ampumavaiheen, mikä johtaisi luovutusvoittoon vastustajalle.

Ohjelmassa on vielä pari virhettä, joita en osannut/ehtinyt korjata. Ensinnäkin, tarkoituksena tietenkin on, että vihollisen osuessa monta kertaa peräkkäin thread.pause() pitäisi pienen välin joka ampumisen jälkeen (merkinnät tulisivat ruudukkoon yksitellen). Nythän tämä toimii niin, että tauko kyllä tulee, mutta vastuksen ammunnat merkataan kaikki vasta kaikkien putkeen tapahtuvien ampumisten jälkeen. Toinen on, että ikkunan ruksia painamalla keskeneräisestä pelistä voi "karata" luovuttamatta. Käyttöliittymän lopeta-painike nimittäin laskee keskeytetyn pelin luovutetuksi, mutta ruksiin en tätä onnistunut lisäämään.
